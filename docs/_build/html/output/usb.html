

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>USB Device Driver &mdash; OpenXC CAN Translator 2.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenXC CAN Translator 2.1 documentation" href="../index.html" />
    <link rel="prev" title="UART Output" href="uart.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="uart.html" title="UART Output"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">OpenXC CAN Translator 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usb-device-driver">
<h1>USB Device Driver<a class="headerlink" href="#usb-device-driver" title="Permalink to this headline">¶</a></h1>
<p>Most users do not need to know the details of the device driver, but for
reference it is documented here.</p>
<p>The CAN translator initializes its USB 2.0 controller as a USB device with three
endpoints. The Android tablet or computer you connect to the translator acts as
the USB host, and must initiate all transfers.</p>
<div class="section" id="endpoint-0">
<h2>Endpoint 0<a class="headerlink" href="#endpoint-0" title="Permalink to this headline">¶</a></h2>
<p>This is the standard USB control transfer endpoint. The CAN transalator
has a few control commands:</p>
<div class="section" id="version">
<h3>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>Version control command: <tt class="docutils literal"><span class="pre">0x80</span></tt></p>
<p>The host can retrieve the version of the CAN translator using the
<tt class="docutils literal"><span class="pre">0x80</span></tt> control request. The data returned is a string containing the
software version of the firmware and the configured vehicle platform in
the format:</p>
<div class="highlight-python"><pre>Version: 1.0 (c346)</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">1.0</span></tt> is the software version and <tt class="docutils literal"><span class="pre">c346</span></tt> is the configured
vehicle.</p>
</div>
<div class="section" id="reset">
<h3>Reset<a class="headerlink" href="#reset" title="Permalink to this headline">¶</a></h3>
<p>Reset control command: <tt class="docutils literal"><span class="pre">0x81</span></tt></p>
<p>The CAN transceivers can be re-initialized by sending the <tt class="docutils literal"><span class="pre">0x81</span></tt>
control request. This command was introduced to work around a bug that
caused the CAN translator to periodically stop responding. The bug still
exists, but there are now workarounds in the code to automatically
re-initialize the transceivers if they stop receiving messages.</p>
</div>
</div>
<div class="section" id="endpoint-1-in">
<h2>Endpoint 1 IN<a class="headerlink" href="#endpoint-1-in" title="Permalink to this headline">¶</a></h2>
<p>Endpoint 1 is configured as a bulk transfer endpoint with the <tt class="docutils literal"><span class="pre">IN</span></tt>
direction (device to host). OpenXC JSON messages read from the vehicle
are sent to the host via <tt class="docutils literal"><span class="pre">IN</span></tt> transactions. When the host is ready to
receive, it should issue a request to read data from this endpoint. A
larger sized request will allow more messages to be batched together
into one USB request and give high overall throughput (with the downside
of introducing delay depending on the size of the request).</p>
</div>
<div class="section" id="endpoint-2-out">
<h2>Endpoint 2 OUT<a class="headerlink" href="#endpoint-2-out" title="Permalink to this headline">¶</a></h2>
<p>OpenXC JSON messages created by the host to send to the vehicle (i.e. to
write to the CAN bus) are sent via <tt class="docutils literal"><span class="pre">OUT</span></tt> transactions. The CAN
translator is prepared to accept writes from the host as soon as it
initializes USB, so they can be sent at any time. There is no special
demarcation on these messages to indicate they are writes - the fact
that they are written in the <tt class="docutils literal"><span class="pre">OUT</span></tt> direction is sufficient. Write
messages must be no more than 4 USB packets in size, i.e. 4 * 64 = 256
bytes.</p>
<p>In the same way the CAN translator is pre-configured with a list of CAN
signals to read and parse from the CAN bus, it is configured with a
whitelist of messages and signals for which to accept writes from the
host. If a message is sent with an unlisted ID it is silently ignored.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">USB Device Driver</a><ul>
<li><a class="reference internal" href="#endpoint-0">Endpoint 0</a><ul>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#reset">Reset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#endpoint-1-in">Endpoint 1 IN</a></li>
<li><a class="reference internal" href="#endpoint-2-out">Endpoint 2 OUT</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="uart.html"
                        title="previous chapter">UART Output</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/output/usb.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="uart.html" title="UART Output"
             >previous</a> |</li>
        <li><a href="../index.html">OpenXC CAN Translator 2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Christopher Peplin.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>