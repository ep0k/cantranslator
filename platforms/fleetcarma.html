

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Digilent chipKIT Max32 &mdash; OpenXC CAN Translator 4.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenXC CAN Translator 4.0 documentation" href="../index.html" />
    <link rel="up" title="Supported Platforms" href="platforms.html" />
    <link rel="next" title="Ford Prototype Vehicle Interface" href="ford.html" />
    <link rel="prev" title="NGX Blueboard LPC1768-H" href="blueboard.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ford.html" title="Ford Prototype Vehicle Interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="blueboard.html" title="NGX Blueboard LPC1768-H"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">OpenXC CAN Translator 4.0 documentation</a> &raquo;</li>
          <li><a href="platforms.html" accesskey="U">Supported Platforms</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="digilent-chipkit-max32">
<h1>Digilent chipKIT Max32<a class="headerlink" href="#digilent-chipkit-max32" title="Permalink to this headline">¶</a></h1>
<p>To build for the FleetCarma data logger, compile with the flag
<tt class="docutils literal"><span class="pre">PLATFORM=FLEETCARMA</span></tt>.</p>
<div class="section" id="flashing-a-pre-compiled-firmware">
<h2>Flashing a Pre-compiled Firmware<a class="headerlink" href="#flashing-a-pre-compiled-firmware" title="Permalink to this headline">¶</a></h2>
<p>Assuming your board has already been flashed with the OpenXC fork of the
<a class="reference external" href="https://github.com/openxc/PIC32-avrdude-bootloader">PIC32 avrdude bootloader</a>,
you must attach an FTDI between your computer and the device.</p>
<div class="section" id="ftdi-cable">
<h3>FTDI Cable<a class="headerlink" href="#ftdi-cable" title="Permalink to this headline">¶</a></h3>
<p>TODO document pins for UART flashing</p>
</div>
<div class="section" id="uploading-script">
<h3>Uploading Script<a class="headerlink" href="#uploading-script" title="Permalink to this headline">¶</a></h3>
<p>Once you have the FTDI cable attached to your computer and to the FleetCarma
board, follow the same steps to upload as for the <a class="reference internal" href="max32.html"><em>chipKIT Max32</em></a>.</p>
</div>
</div>
<div class="section" id="bootloader">
<h2>Bootloader<a class="headerlink" href="#bootloader" title="Permalink to this headline">¶</a></h2>
<p>The FleetCarma uses the &#8220;default&#8221; pins for the CAN controller. The
<a class="reference external" href="https://github.com/openxc/PIC32-avrdude-bootloader">PIC32 avrdude bootloader</a>
works well, but we needed to add a custom board definition to switch from the
&#8220;alternative&#8221; pins (used on the chipKIT Max32) to the default pins.</p>
<p>The fork of the PIC32-avrdude-bootloader repository under the openxc account has
the proper board definition. You will need to install MPLAB X, open the
bootloader project, compile and flash the FleetCarma board via ICSP. We&#8217;ve
tested this from Windows and Linux using the Microchip PICkit 3 programmer.</p>
</div>
<div class="section" id="compiling">
<h2>Compiling<a class="headerlink" href="#compiling" title="Permalink to this headline">¶</a></h2>
<p>The instructions for compiling from source are identical to the <a class="reference internal" href="max32.html"><em>chipKIT
Max32</em></a> except that <tt class="docutils literal"><span class="pre">PLATFORM=FLEETCARMA</span></tt> instead of <tt class="docutils literal"><span class="pre">CHIPKIT</span></tt>. If
you will not be using the avrdude bootloader and will be flashing directly via
ICSP, make sure to also compile with <tt class="docutils literal"><span class="pre">BOOTLOADER=0</span></tt> to enable the program to
run on bare metal.</p>
</div>
<div class="section" id="usb">
<h2>USB<a class="headerlink" href="#usb" title="Permalink to this headline">¶</a></h2>
<p>The micro-USB port on the board is used to send and receive OpenXC messages.</p>
</div>
<div class="section" id="uart">
<h2>UART<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h2>
<p>On the FleetCarma device, <tt class="docutils literal"><span class="pre">UART1A</span></tt> is used for OpenXC output at the 230000
baud rate. Hardware flow control (RTS/CTS) is enabled, so CTS must be pulled low
by the receiving device before data will be sent.</p>
<p>TODO add pinout of expansion header, probably a picture</p>
<p>UART data is sent only if pin 0.58 (or PORTB BIT 4, RB4) is pulled high (to
5vv). If you are using a Bluetooth module like the <a class="reference external" href="https://www.sparkfun.com/products/10269">BlueSMiRF</a> from SparkFun, you need to hard-wire
5v into this pin to actually enabling UART. To disable UART, pull this pin low
or leave it floating.</p>
</div>
<div class="section" id="debug-logging">
<h2>Debug Logging<a class="headerlink" href="#debug-logging" title="Permalink to this headline">¶</a></h2>
<p>On the FleetCarma board, logging is on UART3A at 115200 baud (if the firmware
was compiled with <tt class="docutils literal"><span class="pre">DEBUG=1</span></tt>).</p>
</div>
<div class="section" id="led-lights">
<h2>LED Lights<a class="headerlink" href="#led-lights" title="Permalink to this headline">¶</a></h2>
<p>The FleetCarma board has 2 user controllable LEDs. When CAN activity is
detected, the green LED will be enabled. When USB or Bluetooth is connected, the
blue LED will be enabled.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Digilent chipKIT Max32</a><ul>
<li><a class="reference internal" href="#flashing-a-pre-compiled-firmware">Flashing a Pre-compiled Firmware</a><ul>
<li><a class="reference internal" href="#ftdi-cable">FTDI Cable</a></li>
<li><a class="reference internal" href="#uploading-script">Uploading Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bootloader">Bootloader</a></li>
<li><a class="reference internal" href="#compiling">Compiling</a></li>
<li><a class="reference internal" href="#usb">USB</a></li>
<li><a class="reference internal" href="#uart">UART</a></li>
<li><a class="reference internal" href="#debug-logging">Debug Logging</a></li>
<li><a class="reference internal" href="#led-lights">LED Lights</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="blueboard.html"
                        title="previous chapter">NGX Blueboard LPC1768-H</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ford.html"
                        title="next chapter">Ford Prototype Vehicle Interface</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/platforms/fleetcarma.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ford.html" title="Ford Prototype Vehicle Interface"
             >next</a> |</li>
        <li class="right" >
          <a href="blueboard.html" title="NGX Blueboard LPC1768-H"
             >previous</a> |</li>
        <li><a href="../index.html">OpenXC CAN Translator 4.0 documentation</a> &raquo;</li>
          <li><a href="platforms.html" >Supported Platforms</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Christopher Peplin.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>